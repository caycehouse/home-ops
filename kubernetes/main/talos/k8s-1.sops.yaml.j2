version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:DO/26PGTfaC7KFEmMlMYcMFcrQgpYeQ=,iv:DSSnk1mHitJt4uofIt5B4ExgYaZn9dhFMI9YJy7FbmI=,tag:NafVXgxoPifmWqz08eBRaA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:IcyJ9ppaoFH2SaOM2P1G0N2ThHIODZ7rK3tDB41wEHtYXtLQxTKkWSqkr2w6zRQkxkgvJJSNZxyw+KkcAA2UJVZWFukOT9gj+HMy0Soys/iwPJ3f0cnYMkDzthrOJP2Dtlkh90Ec4q0QXR7q4iq1OrPIqg6hTxNHAZvtmki0e+VvDnAiVE7gAd2y3C1HQSqmyb2l9JFxbBmYZPdTaVF7aO0cgJD5tXi8YX+bSdyRK0KGJLQDEBrKHxVKx84Y5+g1DCcImM7cFifgwASeJQGgCuqpj7kLgW6Z/59TZy5/CwuPAz4NYny7FDlJXyVb94c8x9ekklCYWYPEswu5JcZoxS8FN3cZaPe7t7fLI+xQW1heaAaL1WseBkKvuqq/biRrVBkejky17Q112eFASqhCio/qTGKNGE0vWABJmERV38T2vkilTaofG3reMDMtmuTE91muUxbA3/FDlCL9BMTIIAkBVIXhz9Ao0rqHvd391b4hKxhoNGKW1qP3u7E+8TcZP54oA4p7C5To66yOOOkcf4+pba4yXOexT9zmEYG7SehQgbRn3mkl6SY7JNJFSQPsjzjLIpNvTf7gYw+bBO86APQGJpzCEaz0SeqRA7dcj/CCI9T9qve8uJOKU/GguQcw/HNw3SLSTWqKXn9YyuS2Ewujjw22U2a6iyGop+geWlY1bRWRj2OwyPtwTslYUf2Kyc2oXjUQxVJaPov65Ijm2FgwCE1n5eK04TZbNxWoXiTYseoJTMtfnC0x0dSATtmnogTlFhA/AAd2fFIvEiBwUlv6T+VeO6UlagDVPlVonnd3EFl78AyEsYHPnClM7uNUzVkKaCSo/HWaeuy6qkiFyuFMbjhQrkzWpAFyGXbF+Lis0n0f,iv:CNreyjMh19vNZfLbki5RbJkdy3983SqH4lF1bbYOt6k=,tag:CBvCYN9RQw0kHehPY8UOJQ==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 192.168.42.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraArgs:
      rotate-server-certificates: "true"
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options: ["bind", "rshared", "rw"]
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 192.168.42.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-1
    interfaces:
      - deviceSelector:
          hardwareAddr: e4:54:e8:84:*
          driver: r8169
        dhcp: true
        vlans:
          - routes: []
            dhcp: false
            vlanId: 10
          - routes: []
            dhcp: false
            vlanId: 70
  install:
    diskSelector:
      model: PM991 NVMe Samsung 256GB
    extraKernelArgs:
      - mitigations=off
      - net.ifnames=0
    image: factory.talos.dev/installer/ee96a19631f361e8aca087ead77beb49938e2ca1e4d13b918a537f6adb3aef88:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.grpc.v1.cri"]
          enable_unprivileged_ports = true
          enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 0o644
      content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=4
        noatime=True
        rsize=1048576
        wsize=1048576
  sysctls:
    fs.inotify.max_user_watches: 1048576
    fs.inotify.max_user_instances: 8192
    net.core.netdev_max_backlog: 30000
    net.core.rmem_max: 67108864
    net.core.wmem_max: 67108864
    net.ipv4.tcp_rmem: 4096 87380 33554432
    net.ipv4.tcp_wmem: 4096 65536 33554432
    net.ipv4.tcp_tw_reuse: 1
    net.ipv4.tcp_window_scaling: 1
    vm.nr_hugepages: 1024
  sysfs:
    block.sda.queue.scheduler: none
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      forwardKubeDNSToHost: false # Incompatible with Cilium bpf masquerade
  udev:
    rules:
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:P0s2SnxAg3+kBxO3Y9+6//9rk3BokZrWs2bZNPJcCXXeiRTwj5HaRI72Mds=,iv:fReXji9/f6umNdxfIWHvbXw/1o3HewIJ8Foh11xY06Q=,tag:ie1sP3Qcyg6SPbVkf2gUuA==,type:str]
  secret: ENC[AES256_GCM,data:dydVBKOZjjdxcwy9d/2llateAmfIOaBph0qS+9DpNRuhAVtDaerComymny4=,iv:9viJmIj78N9xGa0k4IxxbWVl1BRWLJRkqBPQAJdri5I=,tag:WifeIlBkNqvS1QU+Yrmyog==,type:str]
  controlPlane:
    endpoint: https://192.168.42.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.69.0.0/16
    serviceSubnets:
      - 10.96.0.0/16
  token: ENC[AES256_GCM,data:GEo1Jfl7s664UsjtIs9F+n46p391FJg=,iv:qF3pToSE16XEZdu+QEPrf0+trnihCHci1afjJ9HZL8M=,tag:WX8XP9dYoAMJBldRwxJCtg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:geEb5IcfVGrf1R9z6fRfiKCHM/rMUoLLTpS113XWyW+dDk9Yuta36Fx4fwV5bF3N8elLudvYdvsrGpEShOiYbvCqeErVLvPDJPgInZDFjp9FFn+gb06oAKatuMvfLSIMCXfJna5WZl6iVWWdwA7Vysu8OetZBre3E2aoF/tXsExk+yStFPFhk5dpp95QYlNWKOaF6XQo0m/PtONFRIkhklrcGKXYRWwadV9rD5vsRj/WMTz09whPtiQ2nfD5zYcO+ocBJecu2W67EUNF4np2l8GPhEHutVZ5jjVW4GmqicW8UiX+Q+d1MKUkA0H9XblUKV/jIg0CyCAE8bXMGZm5sw88NIuzhfx121GQcGl3WXq6unwOzbVOVC/SmjWIYfDdSGG9YS1cQPnYrGXrhMurMmTRSOgiP+++UKNGe35idex6eIJpPf+aJhxHUiZAndf8VZnForR2Q6d3Xt6ugx58d+jUBnCZ31J+00bmKhXAkFuNh15xTYbrD0uQZ4fYv3o4qrTUuKdRXZIUzdwho6ql3LsO+kitorD56y3J2HpC32q6r88dICR/RCHpr/2LU0MEEKc3I1mcgahBWkfAawvqBz//CyMwjqJU9cK7AZ1co0NoV3JO04WXwaGlusEvuCHMHEXmhk39wFPEnzFA9lp8lqyDUd7tgM4p8/TBPXQQv/3GsW4i+YrOVCfOIwOMdS53tw4Bg4hRiej9j19h0no5BsS/vlcCRQLhnS30K6yWJSiTONwY/ZtxPymtzjXt6j3HQ0Xu/BEXOuo4NI8O2cBmLuc5TcfMZViq3VfENlekLoF2OyaUuVtrI8gGHF/6i6Bhoo+zUUl/qhkmgAkqXbhz7Kppu0Pa0FA+3xE5XhwBTIj9j3AORXsF8uhrR2Zu3J8AAwLHsB/caGwJJJ4ziwJz4FYdCIK73zBQ59te9KHAxgAVXcCeRY9Iq3wWXvhR4RufEhrab3O8JWWiJe881oeEIYOL4fk0YHfn+9gMkFxdMgMnXTJlnapuVoFWQcJ/5yGQ90kWK/8vzd1ONQ6VwZOuD7WIGGSrlVYRblmBpw==,iv:BvASahecsYREs8/WXIaFp2x6gKQHfZUDjRd13JeiLAs=,tag:mT605Qe12uz8L7fMFSVgaQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: true
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1lrk7stjrmp70fcqf5ga96j9veymz3ev407n2hz4gev4eg4dlq59qcg3sw3
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBNbDF3a21IWU5NU0s5TGtT
        d1VnTmFRYjZhWjdPNUNwRjZrak5uTnEvNTJzCitGWXZxaVFUdVdFMUdKUmZsa1JD
        Rmpyaks3UDZ4SEZWaDAxMFNQVmMwbUEKLS0tIFRuWC9WODRwRlR3QTNOYit3QXpx
        SElQR2tjRDcyT2V6Yy9OS01mRzliRHcKd9XKDeH4MF7jYwAmo0ZmxkR04fDUPA9k
        IFlKJc4+hmb+nv4NrEz41TRWYEIlzEnL3U+h5nR0j+Qs4qpPSfkpCg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2024-11-09T07:14:21Z"
  mac: ENC[AES256_GCM,data:oHi45yF7ZSUNJq3DTbDZknMARt+D6nVcOxereesgbVHscRqimRempeR68Dnk89o0KjHKpx1/H4epVCUKXGtH4VxEzccuxytY6nbqc+0wxsijWZw4WhiRHq+mt2YVJ4fzC0zHSnbVcloigvifbYFd+hCVysTclu2s23sACflcDD8=,iv:NYIQhhaKM1EJsaWjBIpF+C2wGRZ+7svXGyOwoaeaIEY=,tag:SenyWA2E+CBT1x90HkwcyQ==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.1
